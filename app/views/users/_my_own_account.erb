<%= render 'users/header' %>

<div class="text-center">
  <%= cl_image_tag(@user.photo.path, height: 200, width: 200, fill: :crop, style: "border-radius: 50%") unless @user.photo.nil? %>
  <h1>Your account</h1>
  <h2><%= @user.name %></h2>
  <% unless @user.city == "" %>
    <p>From <%= @user.city %>, <%= @user.zipcode %></p>
  <% end %>
  <% unless @user.start_time.nil? %>
    <p>Available from <%= @user.start_time %>h to <%= @user.end_time %>h</p>
  <% end %>
</div>


<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <h2>Your products</h2>
      <% if @user.items == [] %>
        <p>You have no drugs yet, start dealing with us today!</p>
      <% else %>
        <ul>
          <% @user.items.each do |item| %>
            <li><%= item.name %>: <%= item.price %>â‚¬ / dose</li>
          <% end %>
        </ul>
      <% end %>
    </div>
    <div class="col-xs-12 col-sm-6">
      <% if @user.start_time.nil? %>
        <h2 class="text-center">Start dealing</h2>
        <%= simple_form_for([@user]) do |f| %>
          <%= f.input :address %>
          <%= f.input :zipcode %>
          <%= f.input :city, collection: CITIES %>
          <%= f.input :start_time, label: "When does your shift start?" %>
          <%= f.input :end_time, label: "When does your shift end?" %>
          <%= f.input :description, label: "Tell us a bit about yourself (will appear on your public page)" %>
          <%= f.submit %>
        <% end %>
      <% else %>
        <h2 class="text-center">Deal a new drug</h2>
        <%= simple_form_for([@user, @item]) do |f| %>
          <%= f.input :name, collection: DRUGS, prompt: "Pick a product", id: "item" %>
          <%= f.input :price, label: "Unit Price" %>
          <%= f.submit %>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="co-xs-12">
      <hr>
      <p><%= @user.description %></p>
      <% unless @user.deals == [] %>
        <hr>
        <h2>Your ratings</h2>
        <p><strong>Average score: <%= average_score(@user) %>/5</strong></p>
        <ul>
          <% @user.deals.each do |deal| %>
            <% unless deal.rating.nil? %>
              <li>
                <%= "*" * deal.rating %> by <%= deal.user.name %>
              </li>
            <% end %>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>
</div>
